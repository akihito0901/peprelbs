<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PePreï¼ˆãƒšãƒ—ãƒ¬ï¼‰| æ„›çŠ¬ã«ã´ã£ãŸã‚Šã®"ä¸€çš¿"ãŒè¦‹ã¤ã‹ã‚‹ãƒ•ãƒ¼ãƒ‰è¨ºæ–­</title>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Tailwind Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            beige: '#FDFBF7',
                            orange: '#F6AD55',
                            dark: '#4A3728',
                            accent: '#ED8936'
                        }
                    },
                    fontFamily: {
                        sans: ['Helvetica Neue', 'Arial', 'Hiragino Kaku Gothic ProN', 'Hiragino Sans', 'Meiryo', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #FDFBF7;
            color: #4A3728;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Custom scrollbar for breed list */
        .breed-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .breed-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .breed-scroll::-webkit-scrollbar-thumb {
            background: #F6AD55;
            border-radius: 3px;
        }
    </style>
</head>

<body>
    <!-- Access Link for Dashboard (Review Purpose) -->
    <a href="./dashboard/index.html"
        style="position:fixed; top:10px; right:10px; z-index:9999; background:#F6AD55; color:white; padding:10px 20px; border-radius:30px; font-weight:bold; box-shadow:0 4px 6px rgba(0,0,0,0.1); text-decoration:none;">
        ğŸ“± ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚’è¦‹ã‚‹ &rarr;
    </a>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // --- Mock Data ---
        const PRODUCTS = [
            {
                id: 1,
                name: "ã†ã¾ã‹ (UMAKA)",
                tags: { age: 'all', concern: 'tear_burn', priority: 'S', secondaryConcern: ['appetite'] },
                img: "https://placehold.co/400x300/F6AD55/white?text=UMAKA",
                description: "ã€ç·åˆè©•ä¾¡Sã€‘ä¹å·ç”£ãƒ–ãƒ©ãƒ³ãƒ‰é¶ã€Œè¯å‘³é³¥ã€ã‚’100%ä½¿ç”¨ã€‚æ–™äº­å“è³ªã®å‘³ã¨ãƒãƒ³ã‚ªã‚¤ãƒ«ã‚³ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è£½æ³•ã§ã€æ¶™ã‚„ã‘ã¨é£Ÿã„ã¤ãã®æ‚©ã¿ã‚’åŒæ™‚ã«è§£æ±ºã—ã¾ã™ã€‚",
                feature: "è¯å‘³é³¥100%ãƒ»ãƒãƒ³ã‚ªã‚¤ãƒ«ãƒ»ã‚°ãƒ«ã‚³ã‚µãƒŸãƒ³é…åˆ",
                ownerVoice: "ã€Œæ¶™ã‚„ã‘ãŒç¶ºéº—ã«ãªã£ãŸã€ã€Œã“ã‚Œã—ã‹é£Ÿã¹ãªã„ã€ã¨ã„ã†å£°ãŒç¶šå‡ºã—ã¦ã„ã¾ã™ã€‚",
                price: "Â¥5,478 (åˆå›Â¥3,278)"
            },
            {
                id: 2,
                name: "ã‚„ã‚ã‹",
                tags: { age: 'senior', concern: 'appetite', priority: 'A', secondaryConcern: ['coat', 'joints'] },
                img: "https://placehold.co/400x300/ED8936/white?text=YAWAKA",
                description: "ã€é£Ÿã„ã¤ãç‰¹åŒ–ã€‘ã€Œã†ã¾ã‹ã€ã®å“è³ªã¯ãã®ã¾ã¾ã«ã€æ°´åˆ†ã‚’å«ã¾ã›ãŸã‚½ãƒ•ãƒˆã‚¿ã‚¤ãƒ—ã€‚ç¡¬ã„ãƒ•ãƒ¼ãƒ‰ãŒè‹¦æ‰‹ãªå­ã‚„ã€æ¶ˆåŒ–æ©Ÿèƒ½ãŒè½ã¡ã¦ããŸã‚·ãƒ‹ã‚¢çŠ¬ã«æœ€é©ã§ã™ã€‚",
                feature: "ã‚»ãƒŸãƒ‰ãƒ©ã‚¤ãƒ»å€‹åŒ…è£…ãƒ»å›½ç”£",
                ownerVoice: "æ­¯ãŒå¼±ã£ã¦ããŸã†ã¡ã®å­ã‚‚ã€ã“ã‚Œãªã‚‰å–œã‚“ã§é£Ÿã¹ã¦ãã‚Œã¾ã™ã€‚",
                price: "Â¥6,578 (åˆå›Â¥4,378)"
            },
            {
                id: 3,
                name: "ãƒŸã‚·ãƒ¥ãƒ¯ãƒ³ (å°å‹çŠ¬ç”¨)",
                tags: { age: 'adult', concern: 'joints', priority: 'A', secondaryConcern: ['tear_burn', 'coat', 'obesity'] },
                img: "https://placehold.co/400x300/4A3728/white?text=Mishone",
                description: "ã€å°å‹çŠ¬ã®å‘³æ–¹ã€‘ã€Œç·‘ã‚¤è²ã€é…åˆã§é–¢ç¯€ã‚±ã‚¢ã«ç‰¹åŒ–ã€‚åšã•2.5mmã®æ¥µè–„ç²’ã¯å£ã®å°ã•ãªå­ã§ã‚‚é£Ÿã¹ã‚„ã™ãã€550å††ã®ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‹ã‚‰è©¦ã›ã¾ã™ã€‚",
                feature: "ç·‘ã‚¤è²é…åˆãƒ»æ¥µè–„ç²’ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒ¼ã‚ã‚Š",
                ownerVoice: "ãƒ‘ãƒ†ãƒ©ãŒå¿ƒé…ã§ã—ãŸãŒã€å…ƒæ°—ã«èµ°ã‚Šå›ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚",
                price: "Â¥4,378 (åˆå›ãƒ¢ãƒ‹ã‚¿ãƒ¼Â¥550~)"
            },
            {
                id: 4,
                name: "GRANDS (ã‚°ãƒ©ãƒ³ãƒ„)",
                tags: { age: 'adult', concern: 'freshness', priority: 'B', secondaryConcern: ['allergy', 'none'] },
                img: "https://placehold.co/400x300/48BB78/white?text=GRANDS",
                description: "ã€é®®åº¦é‡è¦–ã€‘500gãšã¤ã®å°åˆ†ã‘ãƒ‘ãƒƒã‚¯ã§ã€ã„ã¤ã§ã‚‚é–‹ã‘ãŸã¦ã®é¦™ã‚Šã‚’ã€‚äººå·¥æ·»åŠ ç‰©ä¸ä½¿ç”¨ã®ã‚°ãƒ¬ã‚¤ãƒ³ãƒ•ãƒªãƒ¼ã§ã€ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼å¯¾ç­–ã‚‚ä¸‡å…¨ã§ã™ã€‚",
                feature: "500gå°åˆ†ã‘ãƒ»ã‚°ãƒ¬ã‚¤ãƒ³ãƒ•ãƒªãƒ¼ãƒ»å…¨3å‘³",
                ownerVoice: "å°åˆ†ã‘ãƒ‘ãƒƒã‚¯ãªã®ã§é…¸åŒ–ã‚’æ°—ã«ã›ãšã€ã„ã¤ã‚‚æ–°é®®ãªã¾ã¾ã‚ã’ã‚‰ã‚Œã¾ã™ã€‚",
                price: "Â¥4,950 (åˆå›Â¥980~)"
            },
            {
                id: 5,
                name: "ãƒšãƒˆã‚³ãƒˆãƒ•ãƒ¼ã‚º",
                tags: { age: 'all', concern: 'appetite', priority: 'B', secondaryConcern: ['tear_burn', 'coat'] },
                img: "https://placehold.co/400x300/E53E3E/white?text=PETOKOTO",
                description: "ã€æ‰‹ä½œã‚Šå“è³ªã€‘æ–°é®®é£Ÿæã‚’ã‚¹ãƒãƒ¼ãƒ åŠ ç†±ã—æ€¥é€Ÿå†·å‡ã€‚ãƒˆãƒƒãƒ”ãƒ³ã‚°ã¨ã—ã¦ä½¿ãˆã°ã€åé£Ÿã®å­ã§ã‚‚é©šãã»ã©é£Ÿã„ã¤ããŒå¤‰ã‚ã‚Šã¾ã™ã€‚",
                feature: "ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ»å†·å‡é…é€ãƒ»ã‚«ã‚¹ã‚¿ãƒ è¨ºæ–­",
                ownerVoice: "åå‰å…¥ã‚Šã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒå±Šã„ã¦æ„Ÿå‹•ï¼åé£ŸãŒå˜˜ã®ã‚ˆã†ã«é£Ÿã¹ã¾ã™ã€‚",
                price: "Â¥4,980~ (è¨ºæ–­ã«ã‚ˆã‚‹)"
            },
            {
                id: 6,
                name: "é¦¬è‚‰è‡ªç„¶ã¥ãã‚Š",
                tags: { age: 'all', concern: 'allergy', priority: 'B', secondaryConcern: ['tear_burn', 'obesity'] },
                img: "https://placehold.co/400x300/D69E2E/white?text=Baniku",
                description: "ã€é¦¬è‚‰å°‚é–€åº—ç™ºã€‘é«˜ã‚¿ãƒ³ãƒ‘ã‚¯ãƒ»ä½è„‚è³ªã®é¦¬è‚‰ã‚’ä½¿ç”¨ã€‚é¶è‚‰ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ã®å­ã‚„ã€ãƒ€ã‚¤ã‚¨ãƒƒãƒˆãŒå¿…è¦ãªå­ã«æœ€é©ãªãƒ—ãƒ¬ãƒŸã‚¢ãƒ ãƒ•ãƒ¼ãƒ‰ã§ã™ã€‚",
                feature: "é¦¬è‚‰ãƒ¡ã‚¤ãƒ³ãƒ»é«˜ã‚¿ãƒ³ãƒ‘ã‚¯ãƒ»ä½ã‚¢ãƒ¬ãƒ«ã‚²ãƒ³",
                ownerVoice: "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼æŒã¡ã§ã™ãŒã€ã“ã‚Œãªã‚‰ç—’ãŒã‚‰ãšã«é£Ÿã¹ã¦ãã‚Œã¾ã™ã€‚",
                price: "Â¥3,300 (åˆå›è©¦é£ŸÂ¥499)"
            },
            {
                id: 7,
                name: "ã‚¦ã‚§ãƒ«ãƒ•ãƒ¼ (Welfoo)",
                tags: { age: 'senior', concern: 'joints', priority: 'B', secondaryConcern: ['appetite', 'coat'] },
                img: "https://placehold.co/400x300/38B2AC/white?text=Welfoo",
                description: "ã€å¸¸æ¸©ãƒ¬ãƒˆãƒ«ãƒˆã€‘å†·è”µä¸è¦ã®ã‚¦ã‚§ãƒƒãƒˆãƒ•ãƒ¼ãƒ‰ã€‚è…¸æ´»æˆåˆ†ã€Œã¯ã´ã­ã™ä¹³é…¸èŒã€é…åˆã§ã€ã‚·ãƒ‹ã‚¢çŠ¬ã®ãŠè…¹ã¨é–¢ç¯€ã‚’å„ªã—ãã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚",
                feature: "å¸¸æ¸©ãƒ¬ãƒˆãƒ«ãƒˆãƒ»è…¸æ´»ãƒ»ãƒã‚¹ãƒˆæŠ•å‡½",
                ownerVoice: "å¸¸æ¸©ã§ä¿å­˜ã§ãã‚‹ã®ãŒæœ¬å½“ã«æ¥½ã€‚æ—…è¡Œã«ã‚‚æŒã£ã¦ã„ã‘ã¾ã™ã€‚",
                price: "Â¥5,960 (åˆå›Â¥990)"
            },
            {
                id: 8,
                name: "GLEBO (ã‚°ãƒ¬ãƒœ)",
                tags: { age: 'senior', concern: 'appetite', priority: 'B', secondaryConcern: ['joints'] },
                img: "https://placehold.co/400x300/805AD5/white?text=GLEBO",
                description: "ã€ã‚·ãƒ‹ã‚¢ç‰¹åŒ–ã€‘è¡°ãˆãŒã¡ãªå—…è¦šã‚’ã€Œã‚«ãƒ„ã‚ªç¯€ã®é¦™ã‚Šã€ã§åˆºæ¿€ã€‚ã‚ªãƒ¡ã‚¬3è„‚è‚ªé…¸é…åˆã§ã€è€åŒ–ã‚±ã‚¢ã¨é£Ÿæ¬²ç¶­æŒã‚’ä¸¡ç«‹ã•ã›ã¾ã™ã€‚",
                feature: "ã‚·ãƒ‹ã‚¢å°‚ç”¨ãƒ»ã‚«ãƒ„ã‚ªç¯€é¢¨å‘³ãƒ»ã‚ªãƒ¡ã‚¬3",
                ownerVoice: "æ€¥ã«é£ŸãŒç´°ããªã£ãŸ13æ­³ã®å­ãŒã€ã“ã‚Œãªã‚‰å®Œé£Ÿã—ã¦ãã‚Œã¾ã—ãŸã€‚",
                price: "Â¥4,840 (åˆå›Â¥500~)"
            },
            {
                id: 9,
                name: "ME&MOMMY",
                tags: { age: 'all', concern: 'none', priority: 'B', secondaryConcern: ['tear_burn'] },
                img: "https://placehold.co/400x300/DD6B20/white?text=MeMommy",
                description: "ã€é£Ÿå“å·¥å ´è£½é€ ã€‘ãƒšãƒƒãƒˆãƒ•ãƒ¼ãƒ‰å·¥å ´ã§ã¯ãªãã€äººã®é£Ÿäº‹ã‚’ä½œã‚‹å·¥å ´ã§è£½é€ ã€‚å®‰å…¨æ€§ã¨ã€Œå…±ã«é£Ÿã¹ã‚‹å¹¸ã›ã€ã‚’å¤§åˆ‡ã«ã™ã‚‹é£¼ã„ä¸»æ§˜ã¸ã€‚",
                feature: "é£Ÿå“å·¥å ´è£½é€ ãƒ»çµ¶å¯¾å®‰å…¨ãƒ»ã‚·ãƒ³ãƒ—ãƒ«",
                ownerVoice: "ç§ãŒé£Ÿã¹ã¦ã‚‚ç¾å‘³ã—ã„ï¼ãã‚Œãã‚‰ã„å®‰å…¨ãªã®ãŒå¬‰ã—ã„ã§ã™ã€‚",
                price: "Â¥3,800"
            },
            {
                id: 10,
                name: "ã“ã®ã“ã®ã”ã¯ã‚“",
                tags: { age: 'all', concern: 'tear_burn', priority: 'C', secondaryConcern: ['coat'] },
                img: "https://placehold.co/400x300/ECC94B/white?text=Konokono",
                description: "ã€å°å‹çŠ¬ã®å®šç•ªã€‘æ¶™ã‚„ã‘ãƒ»ã«ãŠã„ãƒ»æ¯›ä¸¦ã¿ã«ç‰¹åŒ–ã—ãŸå›½ç”£ãƒ•ãƒ¼ãƒ‰ã€‚ã‚«ãƒ„ã‚ªç¯€é¢¨å‘³ã®å„ªã—ã„å‘³ã‚ã„ã§ã€æ·»åŠ ç‰©ã‚‚å¾¹åº•æ’é™¤ã•ã‚Œã¦ã„ã¾ã™ã€‚",
                feature: "æ¶™ã‚„ã‘ç‰¹åŒ–ãƒ»å°å‹çŠ¬ç”¨ãƒ»ã‚«ãƒ„ã‚ªç¯€é¢¨å‘³",
                ownerVoice: "ç›®å…ƒã®æ±šã‚ŒãŒæ°—ã«ãªã‚‰ãªããªã‚Šã€ä½“è‡­ã‚‚æ¸›ã£ãŸæ°—ãŒã—ã¾ã™ã€‚",
                price: "Â¥3,850 (å®šæœŸÂ¥3,278)"
            },
            {
                id: 11,
                name: "ã‚«ãƒŠã‚¬ãƒ³ (CANAGAN)",
                tags: { age: 'all', concern: 'none', priority: 'C', secondaryConcern: ['appetite', 'coat'] },
                img: "https://placehold.co/400x300/E53E3E/white?text=CANAGAN",
                description: "ã€ä¸–ç•ŒåŸºæº–ã€‘ãƒã‚­ãƒ³50%ä»¥ä¸Šã®é«˜ã‚¿ãƒ³ãƒ‘ã‚¯ãƒ»ã‚°ãƒ¬ã‚¤ãƒ³ãƒ•ãƒªãƒ¼ã€‚å…¨çŠ¬ç¨®ãƒ»å…¨å¹´é½¢å¯¾å¿œã§ã€è¿·ã£ãŸã‚‰ã“ã‚Œã‚’é¸ã¹ã°é–“é•ã„ã‚ã‚Šã¾ã›ã‚“ã€‚",
                feature: "ãƒã‚­ãƒ³50%è¶…ãƒ»ã‚°ãƒ¬ã‚¤ãƒ³ãƒ•ãƒªãƒ¼ãƒ»åŠé¡ã‚ã‚Š",
                ownerVoice: "é£Ÿã„ã¤ããŒå‡„ã„ã€‚ç­‹è‚‰è³ªãªä½“ã¤ãã«ãªã£ã¦ãã¾ã—ãŸã€‚",
                price: "Â¥5,038 (åˆå›åŠé¡Â¥2,519)"
            },
            {
                id: 12,
                name: "ãƒ¢ã‚°ãƒ¯ãƒ³",
                tags: { age: 'all', concern: 'coat', priority: 'C', secondaryConcern: ['appetite'] },
                img: "https://placehold.co/400x300/3182CE/white?text=MogWan",
                description: "ã€é­šå¥½ãã«ã€‘ãƒã‚­ãƒ³ã¨ã‚µãƒ¼ãƒ¢ãƒ³ã‚’ãƒ–ãƒ¬ãƒ³ãƒ‰ã—ãŸã€æ‰‹ä½œã‚Šé£Ÿãƒ¬ã‚·ãƒ”ã®ãƒ•ãƒ¼ãƒ‰ã€‚ãŠé­šæˆåˆ†ã§æ¯›ä¸¦ã¿ã‚‚æ”¹å–„ã€‚",
                feature: "ãƒã‚­ãƒ³ï¼†ã‚µãƒ¼ãƒ¢ãƒ³ãƒ»æ‰‹ä½œã‚Šé¢¨ãƒ»åŠé¡ã‚ã‚Š",
                ownerVoice: "æ‰‹ä½œã‚Šé£Ÿã®ãƒ¬ã‚·ãƒ”ã‹ã‚‰ç”Ÿã¾ã‚ŒãŸã ã‘ã‚ã£ã¦ã€é¦™ã‚ŠãŒã™ã”ãè‰¯ã„ã§ã™ã€‚",
                price: "Â¥5,456 (åˆå›åŠé¡Â¥2,728)"
            },
            {
                id: 13,
                name: "ãƒãƒ«ã‚½ãƒ³ã‚º",
                tags: { age: 'adult', concern: 'cost', priority: 'C', secondaryConcern: ['obesity', 'joints'] },
                img: "https://placehold.co/400x300/2F855A/white?text=Nelsons",
                description: "ã€ä¸­ãƒ»å¤§å‹çŠ¬ç”¨ã€‘5kgã®å¤§å®¹é‡ã§ã‚³ã‚¹ãƒ‘æœ€å¼·ã€‚å¤§å‹çŠ¬ã«å¤šã„èƒƒè…¸ãƒˆãƒ©ãƒ–ãƒ«ã‚„é–¢ç¯€ã‚±ã‚¢ã‚‚è€ƒãˆã‚‰ã‚Œã¦ã„ã¾ã™ã€‚",
                feature: "5kgå¤§å®¹é‡ãƒ»ä¸­å¤§å‹çŠ¬ç”¨ãƒ»é«˜ã‚³ã‚¹ãƒ‘",
                ownerVoice: "å¤§å‹çŠ¬ã®å¤šé ­é£¼ã„ã§ã™ãŒã€ã“ã®å“è³ªã§ã“ã®é‡ã¯æœ¬å½“ã«åŠ©ã‹ã‚Šã¾ã™ã€‚",
                price: "Â¥9,560 (å®šæœŸÂ¥7,546)"
            }
        ];

        // --- Diagnosis Logic ---

        const STEPS = [
            {
                id: 'breed',
                question: "æ„›çŠ¬ã®çŠ¬ç¨®ã¯ï¼Ÿ",
                type: 'breed_selector'
            },
            {
                id: 'age',
                question: "æ„›çŠ¬ã®å¹´é½¢ã¯ï¼Ÿ",
                type: 'single',
                options: [
                    { label: "å­çŠ¬ (ã€œ1æ­³)", value: 'puppy' },
                    { label: "æˆçŠ¬ (1ã€œ7æ­³)", value: 'adult' },
                    { label: "ã‚·ãƒ‹ã‚¢ (7æ­³ã€œ)", value: 'senior' }
                ]
            },
            {
                id: 'concern',
                question: "ç¾åœ¨ã®æ‚©ã¿ã¯ï¼Ÿ (è¤‡æ•°é¸æŠå¯)",
                type: 'multiple',
                options: [
                    { label: "æ¶™ã‚„ã‘", value: 'tear_burn' },
                    { label: "æ¯›ä¸¦ã¿ãƒ»çš®è†š", value: 'coat' },
                    { label: "é–¢ç¯€ãƒ»è¶³è…°", value: 'joints' },
                    { label: "è‚¥æº€ãƒ»ä½“é‡", value: 'obesity' },
                    { label: "é£Ÿã„ã¤ã", value: 'appetite' },
                    { label: "ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼", value: 'allergy' },
                    { label: "å€¤æ®µãŒé«˜ã„", value: 'cost' },
                    { label: "ç‰¹ã«ãªã—", value: 'none' }
                ]
            }
        ];

        // ... intermediate code ... 

        const Results = ({ answers, onReset }) => {
            const sortedProducts = useMemo(() => {
                return [...PRODUCTS].map(p => {
                    let score = 0;

                    // 1. Age Match (Critical)
                    if (p.tags.age !== 'all' && p.tags.age !== answers.age) {
                        score -= 1000;
                    } else {
                        score += 50;
                    }

                    // 2. Priority Bonus (Balanced for Reliability)
                    // Adjusted to ensure niche winners can beat 'S' rank
                    if (p.tags.priority === 'S') score += 25;
                    if (p.tags.priority === 'A') score += 15;
                    if (p.tags.priority === 'B') score += 5;

                    // 3. Concern Match (Dominant Factor)
                    if (Array.isArray(answers.concern)) {
                        // Primary Matches
                        if (answers.concern.includes(p.tags.concern)) score += 60; // Huge boost for solving main problem

                        // Secondary Matches
                        if (p.tags.secondaryConcern) {
                            p.tags.secondaryConcern.forEach(c => {
                                if (answers.concern.includes(c)) score += 30;
                            });
                        }

                        // 'None' Handling
                        if (answers.concern.includes('none') && p.tags.concern === 'none') {
                            score += 50;
                        }
                    }

                    return { ...p, score };
                })
                    .filter(p => p.score > 0)
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 3);
            }, [answers]);

            return (
                <div className="max-w-3xl mx-auto py-12 px-4 fade-in">
                    <div className="text-center mb-12">
                        <h2 className="text-3xl font-bold text-brand-dark mb-4">è¨ºæ–­çµæœ</h2>
                        <div className="inline-block bg-brand-beige px-6 py-2 rounded-full border border-brand-orange mb-4">
                            <span className="text-brand-orange font-bold mr-2">{answers.breed}</span>
                            <span className="text-gray-600">ã®</span>
                            <span className="text-brand-orange font-bold mx-2">{answers.age === 'puppy' ? 'å­çŠ¬' : answers.age === 'senior' ? 'ã‚·ãƒ‹ã‚¢çŠ¬' : 'æˆçŠ¬'}</span>
                            <span className="text-gray-600">ã«ã´ã£ãŸã‚Šãªã®ã¯...</span>
                        </div>
                        <p className="text-lg text-gray-600">
                            ã‚ãªãŸã®ã‚ã‚“ã¡ã‚ƒã‚“å°‚ç”¨ã®<br className="md:hidden" />æœ€å¼·ãƒ•ãƒ¼ãƒ‰BEST3ã‚’é¸å‡ºã—ã¾ã—ãŸï¼
                        </p>
                    </div>

                    <div className="space-y-10">
                        {sortedProducts.map((p, idx) => (
                            <ProductCard key={p.id} product={p} rank={idx + 1} />
                        ))}
                    </div>

                    <div className="mt-16 text-center bg-white p-6 md:p-8 rounded-2xl shadow-sm border border-orange-100 max-w-xl mx-auto">
                        <h3 className="text-lg font-bold text-brand-orange mb-2">
                            PePreã®é¸å®šåŸºæº–ã«ã¤ã„ã¦
                        </h3>
                        <p className="text-gray-500 text-sm leading-relaxed">
                            â€»æˆåˆ†ã€åŸææ–™ã€å£ã‚³ãƒŸã€ã‚³ã‚¹ãƒ‘ãªã©ã‚’ç·åˆçš„ã«åˆ†æã—ã€<br className="hidden md:block" />
                            ã‚ãªãŸã®æ„›çŠ¬ã«æœ€ã‚‚ãƒ¡ãƒªãƒƒãƒˆã®ã‚ã‚‹å•†å“ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚
                        </p>
                        <div className="mt-6">
                            <button onClick={onReset} className="text-gray-400 underline hover:text-brand-orange transition-colors">
                                ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const BREEDS = {
            "ã‚è¡Œ": [
                "ã‚¢ãƒ¼ãƒ•ã‚§ãƒ³ãƒ”ãƒ³ã‚·ãƒ£ãƒ¼", "ã‚¢ã‚¤ãƒªãƒƒã‚·ãƒ¥ãƒ»ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ»ã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«", "ã‚¢ã‚¤ãƒªãƒƒã‚·ãƒ¥ãƒ»ã‚¦ãƒ«ãƒ•ãƒã‚¦ãƒ³ãƒ‰",
                "ã‚¢ã‚¤ãƒªãƒƒã‚·ãƒ¥ãƒ»ã‚»ã‚¿ãƒ¼", "ã‚¢ã‚¤ãƒªãƒƒã‚·ãƒ¥ãƒ»ã‚½ãƒ•ãƒˆã‚³ãƒ¼ãƒ†ãƒƒãƒ‰ãƒ»ã‚¦ã‚£ãƒ¼ãƒˆãƒ³ãƒ»ãƒ†ãƒªã‚¢", "ã‚¢ã‚¤ãƒªãƒƒã‚·ãƒ¥ãƒ»ãƒ†ãƒªã‚¢",
                "ã‚¢ã‚¤ãƒªãƒƒã‚·ãƒ¥ãƒ»ãƒ¬ãƒƒãƒ‰ãƒ»ã‚¢ãƒ³ãƒ‰ãƒ»ãƒ›ãƒ¯ã‚¤ãƒˆãƒ»ã‚»ã‚¿ãƒ¼", "ç§‹ç”°", "ã‚¢ãƒ•ã‚¬ãƒ³ãƒ»ãƒã‚¦ãƒ³ãƒ‰", "ã‚¢ãƒ¡ãƒªã‚«ãƒ³ãƒ»ã‚¢ã‚­ã‚¿",
                "ã‚¢ãƒ¡ãƒªã‚«ãƒ³ãƒ»ã‚³ãƒƒã‚«ãƒ¼ãƒ»ã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«", "ã‚¢ãƒ¡ãƒªã‚«ãƒ³ãƒ»ã‚¹ã‚¿ãƒƒãƒ•ã‚©ãƒ¼ãƒ‰ã‚·ãƒ£ãƒ¼ãƒ»ãƒ†ãƒªã‚¢", "ã‚¢ãƒ¡ãƒªã‚«ãƒ³ãƒ»ãƒ•ã‚©ãƒƒã‚¯ã‚¹ãƒã‚¦ãƒ³ãƒ‰",
                "ã‚¢ãƒ©ã‚¹ã‚«ãƒ³ãƒ»ãƒãƒ©ãƒŸãƒ¥ãƒ¼ãƒˆ", "ã‚¤ã‚¿ãƒªã‚¢ãƒ³ãƒ»ã‚°ãƒ¬ãƒ¼ãƒã‚¦ãƒ³ãƒ‰", "ã‚¤ãƒ“ã‚¶ãƒ³ãƒ»ãƒã‚¦ãƒ³ãƒ‰",
                "ã‚¤ãƒ³ã‚°ãƒªãƒƒã‚·ãƒ¥ãƒ»ã‚³ãƒƒã‚«ãƒ¼ãƒ»ã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«", "ã‚¤ãƒ³ã‚°ãƒªãƒƒã‚·ãƒ¥ãƒ»ã‚¹ãƒ—ãƒªãƒ³ã‚¬ãƒ¼ãƒ»ã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«", "ã‚¤ãƒ³ã‚°ãƒªãƒƒã‚·ãƒ¥ãƒ»ã‚»ã‚¿ãƒ¼",
                "ã‚¤ãƒ³ã‚°ãƒªãƒƒã‚·ãƒ¥ãƒ»ãƒã‚¤ãƒ³ã‚¿ãƒ¼", "ã‚¦ã‚£ãƒšãƒƒãƒˆ", "ã‚¦ã‚¨ã‚¹ãƒˆãƒ»ãƒã‚¤ãƒ©ãƒ³ãƒ‰ãƒ»ãƒ›ãƒ¯ã‚¤ãƒˆãƒ»ãƒ†ãƒªã‚¢",
                "ã‚¦ã‚§ãƒ«ã‚·ãƒ¥ãƒ»ã‚³ãƒ¼ã‚®ãƒ¼ãƒ»ã‚«ãƒ¼ãƒ‡ã‚£ã‚¬ãƒ³", "ã‚¦ã‚§ãƒ«ã‚·ãƒ¥ãƒ»ã‚³ãƒ¼ã‚®ãƒ¼ãƒ»ãƒšãƒ³ãƒ–ãƒ­ãƒ¼ã‚¯", "ã‚¦ã‚§ãƒ«ã‚·ãƒ¥ãƒ»ã‚¹ãƒ—ãƒªãƒ³ã‚¬ãƒ¼ãƒ»ã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«",
                "ã‚¦ã‚§ãƒ«ã‚·ãƒ¥ãƒ»ãƒ†ãƒªã‚¢", "ã‚¨ã‚¢ãƒ‡ãƒ¼ãƒ«ãƒ»ãƒ†ãƒªã‚¢", "ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ãƒ³ãƒ»ã‚­ãƒ£ãƒˆãƒ«ãƒ»ãƒ‰ãƒƒã‚°", "ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ãƒ³ãƒ»ã‚±ãƒ«ãƒ”ãƒ¼",
                "ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ãƒ³ãƒ»ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰", "ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ãƒ³ãƒ»ã‚·ãƒ«ã‚­ãƒ¼ãƒ»ãƒ†ãƒªã‚¢", "ã‚ªãƒ¼ã‚¹ãƒˆãƒ©ãƒªã‚¢ãƒ³ãƒ»ãƒ†ãƒªã‚¢",
                "ã‚ªãƒ¼ãƒ«ãƒ‰ãƒ»ã‚¤ãƒ³ã‚°ãƒªãƒƒã‚·ãƒ¥ãƒ»ã‚·ãƒ¼ãƒ—ãƒ‰ãƒƒã‚°"
            ],
            "ã‹è¡Œ": [
                "ã‚«ãƒ¼ãƒªãƒ¼ã‚³ãƒ¼ãƒ†ãƒƒãƒ‰ãƒ»ãƒ¬ãƒˆãƒªãƒ¼ãƒãƒ¼", "ç”²æ–", "ã‚«ãƒ‹ãƒ¼ãƒ³ãƒ˜ãƒ³ãƒ»ãƒ€ãƒƒã‚¯ã‚¹ãƒ•ãƒ³ãƒ‰", "ç´€å·",
                "ã‚­ãƒ¼ã‚¹ãƒ›ãƒ³ãƒ‰ï¼ˆã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ»ã‚¦ãƒ«ãƒ•ã‚¹ãƒ”ãƒƒãƒ„ï¼‰", "ã‚­ãƒ£ãƒãƒªã‚¢ãƒ»ã‚­ãƒ³ã‚°ãƒ»ãƒãƒ£ãƒ¼ãƒ«ã‚ºãƒ»ã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«",
                "ã‚­ãƒ³ã‚°ãƒ»ãƒãƒ£ãƒ¼ãƒ«ã‚ºãƒ»ã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«", "ã‚¯ãƒ©ãƒ³ãƒãƒ¼ãƒ»ã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«", "ã‚°ãƒ¬ãƒ¼ãƒˆãƒ»ãƒ‡ãƒ¼ãƒ³", "ã‚°ãƒ¬ãƒ¼ãƒˆãƒ»ãƒ”ãƒ¬ãƒ‹ãƒ¼ã‚º",
                "ã‚°ãƒ¬ãƒ¼ãƒã‚¦ãƒ³ãƒ‰", "ã‚±ã‚¢ãƒ¼ãƒ³ãƒ»ãƒ†ãƒªã‚¢", "ã‚±ãƒªãƒ¼ãƒ»ãƒ–ãƒ«ãƒ¼ãƒ»ãƒ†ãƒªã‚¢", "ã‚³ãƒ¼ã‚¤ã‚±ãƒ«ãƒ›ãƒ³ãƒ‡ã‚£ã‚¨",
                "ã‚´ãƒ¼ãƒ‰ãƒ³ãƒ»ã‚»ã‚¿ãƒ¼", "ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ãƒ»ãƒ¬ãƒˆãƒªãƒ¼ãƒãƒ¼", "ã‚³ãƒ¢ãƒ³ãƒ‰ãƒ¼ãƒ«"
            ],
            "ã•è¡Œ": [
                "ã‚µãƒ¢ã‚¨ãƒ‰", "ã‚µãƒ«ãƒ¼ã‚­", "ã‚·ãƒ¼ãƒ»ã‚ºãƒ¼", "ã‚·ãƒ¼ãƒªãƒãƒ ãƒ»ãƒ†ãƒªã‚¢", "ã‚·ã‚§ãƒƒãƒˆãƒ©ãƒ³ãƒ‰ãƒ»ã‚·ãƒ¼ãƒ—ãƒ‰ãƒƒã‚°",
                "å››å›½", "æŸ´", "ã‚·ãƒ™ãƒªã‚¢ãƒ³ãƒ»ãƒã‚¹ã‚­ãƒ¼", "ã‚·ãƒ£ãƒ¼ãƒ»ãƒšã‚¤", "ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ»ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰ãƒ»ãƒ‰ãƒƒã‚°",
                "ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ»ã‚·ãƒ§ãƒ¼ãƒˆãƒ˜ã‚¢ãƒ¼ãƒ‰ãƒ»ãƒã‚¤ãƒ³ã‚¿ãƒ¼", "ã‚¸ãƒ£ãƒ¼ãƒãƒ³ãƒ»ãƒ¯ã‚¤ã‚¢ãƒ¼ãƒ˜ã‚¢ãƒ¼ãƒ‰ãƒ»ãƒã‚¤ãƒ³ã‚¿ãƒ¼",
                "ã‚¸ãƒ£ã‚¤ã‚¢ãƒ³ãƒˆãƒ»ã‚·ãƒ¥ãƒŠã‚¦ã‚¶ãƒ¼", "ã‚¸ãƒ£ãƒƒã‚¯ãƒ»ãƒ©ãƒƒã‚»ãƒ«ãƒ»ãƒ†ãƒªã‚¢", "ã‚·ãƒ§ãƒ¼ãƒˆãƒ˜ã‚¢ãƒ¼ãƒ‰ãƒ»ãƒãƒ³ã‚¬ãƒªã‚¢ãƒ³ãƒ»ãƒ“ã‚ºãƒ©",
                "ã‚¹ã‚«ã‚¤ãƒ»ãƒ†ãƒªã‚¢", "ã‚¹ã‚­ãƒƒãƒ‘ãƒ¼ã‚­", "ã‚¹ã‚³ãƒ†ã‚£ãƒƒã‚·ãƒ¥ãƒ»ãƒ†ãƒªã‚¢", "ã‚¹ã‚¿ãƒƒãƒ•ã‚©ãƒ¼ãƒ‰ã‚·ãƒ£ãƒ¼ãƒ»ãƒ–ãƒ«ãƒ»ãƒ†ãƒªã‚¢",
                "ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ»ã‚·ãƒ¥ãƒŠã‚¦ã‚¶ãƒ¼", "ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ãƒ»ãƒ—ãƒ¼ãƒ‰ãƒ«", "ã‚¹ãƒ ãƒ¼ã‚¹ãƒ»ã‚³ãƒªãƒ¼", "ã‚¹ãƒ ãƒ¼ã‚¹ãƒ»ãƒ•ã‚©ãƒƒã‚¯ã‚¹ãƒ»ãƒ†ãƒªã‚¢",
                "ã‚¹ãƒ«ãƒ¼ã‚®", "ã‚»ãƒ³ãƒˆãƒ»ãƒãƒ¼ãƒŠãƒ¼ãƒ‰"
            ],
            "ãŸè¡Œ": [
                "ã‚¿ã‚¤ãƒ»ãƒªãƒƒã‚¸ãƒãƒƒã‚¯ãƒ»ãƒ‰ãƒƒã‚°", "ãƒ€ãƒƒã‚¯ã‚¹ãƒ•ãƒ³ãƒ‰", "ãƒ€ãƒ«ãƒ¡ã‚·ã‚¢ãƒ³", "ãƒ€ãƒ³ãƒ‡ã‚£ãƒ»ãƒ‡ã‚£ãƒ³ãƒ¢ãƒ³ãƒˆãƒ»ãƒ†ãƒªã‚¢",
                "ãƒã‚§ã‚µãƒ”ãƒ¼ã‚¯ãƒ»ãƒ™ã‚¤ãƒ»ãƒ¬ãƒˆãƒªãƒ¼ãƒãƒ¼", "ãƒãƒ™ã‚¿ãƒ³ãƒ»ã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«", "ãƒãƒ™ã‚¿ãƒ³ãƒ»ãƒ†ãƒªã‚¢", "ãƒãƒ™ã‚¿ãƒ³ãƒ»ãƒã‚¹ãƒ†ã‚£ãƒ•",
                "ãƒãƒ£ã‚¤ãƒ‹ãƒ¼ã‚ºãƒ»ã‚¯ãƒ¬ã‚¹ãƒ†ãƒƒãƒ‰ãƒ»ãƒ‰ãƒƒã‚°", "ãƒãƒ£ã‚¦ãƒ»ãƒãƒ£ã‚¦", "ãƒãƒ¯ãƒ¯", "ç‹†", "ãƒ‡ã‚£ã‚¢ãƒã‚¦ãƒ³ãƒ‰",
                "ãƒˆã‚¤ãƒ»ãƒ—ãƒ¼ãƒ‰ãƒ«", "ãƒˆã‚¤ãƒ»ãƒãƒ³ãƒã‚§ã‚¹ã‚¿ãƒ¼ãƒ»ãƒ†ãƒªã‚¢", "ãƒ‰ãƒ¼ãƒ™ãƒ«ãƒãƒ³", "ãƒ‰ã‚´ãƒ»ã‚¢ãƒ«ãƒ˜ãƒ³ãƒ†ã‚£ãƒ¼ãƒ", "åœŸä½"
            ],
            "ãªè¡Œ": [
                "ãƒŠãƒãƒªã‚¿ãƒ³ãƒ»ãƒã‚¹ãƒ†ã‚£ãƒ•", "æ—¥æœ¬ã‚¹ãƒ”ãƒƒãƒ„", "æ—¥æœ¬ãƒ†ãƒªã‚¢", "ãƒ‹ãƒ¥ãƒ¼ãƒ•ã‚¡ãƒ³ãƒ‰ãƒ©ãƒ³ãƒ‰",
                "ãƒãƒ´ã‚¡ãƒ»ã‚¹ã‚³ã‚·ã‚¢ãƒ»ãƒ€ãƒƒã‚¯ãƒ»ãƒˆãƒ¼ãƒªãƒ³ã‚°ãƒ»ãƒ¬ãƒˆãƒªãƒ¼ãƒãƒ¼", "ãƒãƒ¼ãƒ•ã‚©ãƒ¼ã‚¯ãƒ»ãƒ†ãƒªã‚¢", "ãƒãƒ¼ãƒªãƒƒãƒãƒ»ãƒ†ãƒªã‚¢",
                "ãƒãƒ«ã‚¦ã‚§ã‚¸ã‚¢ãƒ³ãƒ»ã‚¨ãƒ«ã‚¯ãƒã‚¦ãƒ³ãƒ‰"
            ],
            "ã¯è¡Œ": [
                "ãƒ‘ãƒ¼ã‚½ãƒ³ãƒ»ãƒ©ãƒƒã‚»ãƒ«ãƒ»ãƒ†ãƒªã‚¢", "ãƒãƒ¼ãƒ‹ãƒ¼ã‚ºãƒ»ãƒã‚¦ãƒ³ãƒ†ãƒ³ãƒ»ãƒ‰ãƒƒã‚°", "ãƒ‘ã‚°", "ãƒã‚»ãƒƒãƒˆãƒ»ãƒã‚¦ãƒ³ãƒ‰",
                "ãƒã‚»ãƒ³ã‚¸ãƒ¼", "ãƒ‘ãƒ”ãƒ¨ãƒ³", "ãƒãƒªã‚¢", "ãƒ“ã‚¢ãƒ‡ãƒƒãƒ‰ãƒ»ã‚³ãƒªãƒ¼", "ãƒ“ãƒ¼ã‚°ãƒ«", "ãƒ“ã‚·ãƒ§ãƒ³ãƒ»ãƒ•ãƒªãƒ¼ã‚¼",
                "ãƒ”ãƒ¬ãƒ‹ã‚¢ãƒ³ãƒ»ã‚·ãƒ¼ãƒ—ãƒ‰ãƒƒã‚°", "ãƒ”ãƒ¬ãƒ‹ã‚¢ãƒ³ãƒ»ãƒã‚¹ãƒ†ã‚£ãƒ•", "ãƒ•ã‚¡ãƒ©ã‚ªãƒ»ãƒã‚¦ãƒ³ãƒ‰", "ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒ»ã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«",
                "ãƒ–ãƒ¼ãƒ“ã‚¨ãƒ»ãƒ‡ãƒ»ãƒ•ãƒ©ãƒ³ãƒ€ãƒ¼ã‚¹", "ãƒ—ãƒ¼ãƒªãƒ¼", "ãƒ—ãƒãƒ»ãƒã‚»ãƒƒãƒˆãƒ»ã‚°ãƒªãƒ•ã‚©ãƒ³ãƒ»ãƒãƒ³ãƒ‡ãƒ¼ãƒ³", "ãƒ—ãƒãƒ»ãƒ–ãƒ©ãƒãƒ³ã‚½ãƒ³",
                "ãƒ–ãƒ©ã‚¸ãƒªã‚¢ãƒ³ãƒ»ã‚¬ãƒ¼ãƒ‰ãƒ»ãƒ‰ãƒƒã‚°", "ãƒ–ãƒ©ãƒƒã‚¯ãƒ»ã‚¢ãƒ³ãƒ‰ãƒ»ã‚¿ãƒ³ãƒ»ã‚¯ãƒ¼ãƒ³ãƒã‚¦ãƒ³ãƒ‰", "ãƒ•ãƒ©ãƒƒãƒˆã‚³ãƒ¼ãƒ†ãƒƒãƒ‰ãƒ»ãƒ¬ãƒˆãƒªãƒ¼ãƒãƒ¼",
                "ãƒ–ãƒ©ãƒƒãƒ‰ãƒã‚¦ãƒ³ãƒ‰", "ãƒ–ãƒªã‚¢ãƒ¼ãƒ‰", "ãƒ–ãƒªã‚¿ãƒ‹ãƒ¼ãƒ»ã‚¹ãƒ‘ãƒ‹ã‚¨ãƒ«", "ãƒ–ãƒªãƒ¥ãƒƒã‚»ãƒ«ãƒ»ã‚°ãƒªãƒ•ã‚©ãƒ³", "ãƒ–ãƒ«ãƒ»ãƒ†ãƒªã‚¢",
                "ãƒ–ãƒ«ãƒ‰ãƒƒã‚°", "ãƒ–ãƒ«ãƒã‚¹ãƒ†ã‚£ãƒ•", "ãƒ•ãƒ¬ãƒ³ãƒãƒ»ãƒ–ãƒ«ãƒ‰ãƒƒã‚°", "ãƒšã‚­ãƒ‹ãƒ¼ã‚º", "ãƒ™ãƒ‰ãƒªãƒ³ãƒˆãƒ³ãƒ»ãƒ†ãƒªã‚¢",
                "ãƒšãƒ«ãƒ¼ãƒ“ã‚¢ãƒ³ãƒ»ãƒ˜ã‚¢ãƒ¬ã‚¹ãƒ»ãƒ‰ãƒƒã‚°", "ãƒ™ãƒ«ã‚¸ã‚¢ãƒ³ãƒ»ã‚°ãƒªãƒ•ã‚©ãƒ³", "ãƒ™ãƒ«ã‚¸ã‚¢ãƒ³ãƒ»ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰ãƒ»ãƒ‰ãƒƒã‚°ãƒ»ã‚°ãƒ­ãƒ¼ãƒãƒ³ãƒ€ãƒ¼ãƒ«",
                "ãƒ™ãƒ«ã‚¸ã‚¢ãƒ³ãƒ»ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰ãƒ»ãƒ‰ãƒƒã‚°ãƒ»ã‚¿ãƒ¼ãƒ“ãƒ¥ãƒ¬ãƒ³", "ãƒ™ãƒ«ã‚¸ã‚¢ãƒ³ãƒ»ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰ãƒ»ãƒ‰ãƒƒã‚°ãƒ»ãƒãƒªãƒã‚¢",
                "ãƒ™ãƒ«ã‚¸ã‚¢ãƒ³ãƒ»ã‚·ã‚§ãƒ‘ãƒ¼ãƒ‰ãƒ»ãƒ‰ãƒƒã‚°ãƒ»ãƒ©ã‚±ãƒã‚¢", "ãƒœãƒ¼ãƒ€ãƒ¼ãƒ»ã‚³ãƒªãƒ¼", "ãƒœãƒ¼ãƒ€ãƒ¼ãƒ»ãƒ†ãƒªã‚¢",
                "ãƒãƒ¼ãƒãƒ¥ã‚®ãƒ¼ã‚ºãƒ»ã‚¦ã‚©ãƒ¼ã‚¿ãƒ¼ãƒ»ãƒ‰ãƒƒã‚°", "ãƒœã‚¯ã‚µãƒ¼", "ãƒœã‚¹ãƒˆãƒ³ãƒ»ãƒ†ãƒªã‚¢", "åŒ—æµ·é“", "ãƒãƒ¡ãƒ©ãƒ‹ã‚¢ãƒ³",
                "ãƒãƒªãƒƒã‚·ãƒ¥ãƒ»ãƒ­ãƒ¼ãƒ©ãƒ³ãƒ‰ãƒ»ã‚·ãƒ¼ãƒ—ãƒ‰ãƒƒã‚°", "ãƒœãƒ«ã‚¾ã‚¤", "ãƒœãƒ«ãƒ‰ãƒ¼ãƒ»ãƒã‚¹ãƒ†ã‚£ãƒ•", "ãƒœãƒ­ãƒ‹ãƒ¼ã‚º"
            ],
            "ã¾è¡Œ": [
                "ãƒã‚¹ãƒ†ã‚£ãƒ•", "ãƒãƒ«ãƒãƒ¼ã‚º", "ãƒãƒ¬ãƒ³ãƒãƒ»ã‚·ãƒ¼ãƒ—ãƒ‰ãƒƒã‚°", "ãƒãƒ³ãƒã‚§ã‚¹ã‚¿ãƒ¼ãƒ»ãƒ†ãƒªã‚¢", "ãƒŸãƒ‡ã‚£ã‚¢ãƒ ãƒ»ãƒ—ãƒ¼ãƒ‰ãƒ«",
                "ãƒŸãƒ‹ãƒãƒ¥ã‚¢ãƒ»ã‚·ãƒ¥ãƒŠã‚¦ã‚¶ãƒ¼", "ãƒŸãƒ‹ãƒãƒ¥ã‚¢ãƒ»ãƒ€ãƒƒã‚¯ã‚¹ãƒ•ãƒ³ãƒ‰", "ãƒŸãƒ‹ãƒãƒ¥ã‚¢ãƒ»ãƒ”ãƒ³ã‚·ãƒ£ãƒ¼", "ãƒŸãƒ‹ãƒãƒ¥ã‚¢ãƒ»ãƒ—ãƒ¼ãƒ‰ãƒ«",
                "ãƒŸãƒ‹ãƒãƒ¥ã‚¢ãƒ»ãƒ–ãƒ«ãƒ»ãƒ†ãƒªã‚¢", "ãƒ¡ã‚­ã‚·ã‚«ãƒ³ãƒ»ãƒ˜ã‚¢ãƒ¬ã‚¹ãƒ»ãƒ‰ãƒƒã‚°"
            ],
            "ã‚„è¡Œ": [
                "ãƒ¦ãƒ¼ãƒ©ã‚·ã‚¢", "ãƒ¨ãƒ¼ã‚¯ã‚·ãƒ£ãƒ¼ãƒ»ãƒ†ãƒªã‚¢"
            ],
            "ã‚‰è¡Œ": [
                "ãƒ©ãƒ¼ã‚¸ãƒ»ãƒŸãƒ¥ãƒ³ã‚¹ã‚¿ãƒ¼ãƒ¬ãƒ³ãƒ€ãƒ¼", "ãƒ©ã‚µãƒ»ã‚¢ãƒ—ã‚½", "ãƒ©ãƒ•ãƒ»ã‚³ãƒªãƒ¼", "ãƒ©ãƒ–ãƒ©ãƒ‰ãƒ¼ãƒ«ãƒ»ãƒ¬ãƒˆãƒªãƒ¼ãƒãƒ¼",
                "ãƒ¬ãƒ¼ã‚¯ãƒ©ãƒ³ãƒ‰ãƒ»ãƒ†ãƒªã‚¢", "ãƒ¬ã‚ªãƒ³ãƒ™ãƒ«ã‚¬ãƒ¼", "ãƒ­ãƒ¼ã‚·ã‚§ãƒ³", "ãƒ­ãƒ¼ãƒ‡ã‚·ã‚¢ãƒ³ãƒ»ãƒªãƒƒã‚¸ãƒãƒƒã‚¯", "ãƒ­ãƒƒãƒˆãƒ¯ã‚¤ãƒ©ãƒ¼"
            ],
            "ã‚è¡Œ": [
                "ãƒ¯ã‚¤ã‚¢ãƒ¼ãƒ»ãƒ•ã‚©ãƒƒã‚¯ã‚¹ãƒ»ãƒ†ãƒªã‚¢", "ãƒ¯ã‚¤ãƒãƒ©ãƒŠãƒ¼"
            ]
        };

        const BREED_TABS = Object.keys(BREEDS);

        // --- Components ---

        const Header = () => (
            <header className="py-6 px-4 bg-white shadow-sm sticky top-0 z-50">
                <div className="max-w-4xl mx-auto flex items-center justify-between">
                    <div className="flex items-center gap-3">
                        <img src="./images/logo.png" alt="PePre Logo" className="h-10 w-auto mix-blend-multiply" />
                        <h1 className="text-xl md:text-2xl font-bold tracking-wide text-brand-dark">PePre</h1>
                    </div>
                </div>
            </header>
        );

        const Footer = () => (
            <footer className="bg-brand-dark text-brand-beige py-8 text-center mt-12">
                <p className="text-sm opacity-80">&copy; 2026 PePre All Rights Reserved.</p>
                <p className="text-xs mt-2 opacity-60">æ„›çŠ¬ã®å¥åº·ã‚’ç¬¬ä¸€ã«è€ƒãˆã‚‹ã‚»ãƒ¬ã‚¯ãƒˆã‚·ãƒ§ãƒƒãƒ—</p>
            </footer>
        );

        const Button = ({ children, onClick, variant = 'primary', className = '', disabled = false }) => {
            const baseStyle = "px-8 py-3 rounded-full font-bold transition-all transform active:scale-95 shadow-lg block w-full md:w-auto text-center cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed";
            const variants = {
                primary: "bg-brand-orange text-white hover:bg-brand-accent",
                outline: "border-2 border-brand-orange text-brand-orange hover:bg-orange-50",
                secondary: "bg-gray-200 text-gray-700 hover:bg-gray-300"
            };
            return (
                <button onClick={onClick} disabled={disabled} className={`${baseStyle} ${variants[variant]} ${className}`}>
                    {children}
                </button>
            );
        };



        const DiagnosisWizard = ({ onComplete }) => {
            const [currentStep, setCurrentStep] = useState(0);
            const [answers, setAnswers] = useState({});
            const [activeTab, setActiveTab] = useState(BREED_TABS[0]);
            const [tempMultiSelection, setTempMultiSelection] = useState([]);

            const step = STEPS[currentStep];

            const handleNext = (val) => {
                const stepKey = step.id;
                const newAnswers = { ...answers, [stepKey]: val };

                // Clear temp selection for next step if it was multi
                setTempMultiSelection([]);

                setAnswers(newAnswers);

                if (currentStep < STEPS.length - 1) {
                    setTimeout(() => {
                        setCurrentStep(prev => prev + 1);
                        window.scrollTo({ top: 0, behavior: 'smooth' });
                    }, 200);
                } else {
                    onComplete(newAnswers);
                }
            };

            const toggleMultiSelect = (val) => {
                setTempMultiSelection(prev => {
                    if (val === 'none') return ['none']; // Mutually exclusive 'none'
                    if (prev.includes('none')) return [val]; // Remove 'none' if selecting others

                    return prev.includes(val)
                        ? prev.filter(v => v !== val)
                        : [...prev, val];
                });
            };

            const renderStepContent = () => {
                // --- Breed Selector ---
                if (step.type === 'breed_selector') {
                    return (
                        <div className="w-full">
                            {/* Tabs */}
                            <div className="flex flex-wrap gap-2 justify-center mb-6">
                                {BREED_TABS.map(tab => (
                                    <button
                                        key={tab}
                                        onClick={() => setActiveTab(tab)}
                                        className={`px-3 py-2 rounded-full text-sm font-bold transition-colors ${activeTab === tab
                                            ? 'bg-brand-orange text-white ring-2 ring-offset-2 ring-brand-orange'
                                            : 'bg-white text-gray-500 hover:bg-gray-100'
                                            }`}
                                    >
                                        {tab}
                                    </button>
                                ))}
                            </div>
                            {/* Breed Buttons */}
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-3 max-h-96 overflow-y-auto p-2 breed-scroll">
                                {BREEDS[activeTab].map(breed => (
                                    <button
                                        key={breed}
                                        onClick={() => handleNext(breed)}
                                        className="bg-white border hover:border-brand-orange p-4 rounded-lg shadow-sm text-sm font-medium text-brand-dark hover:bg-orange-50 transition-all text-left flex items-center"
                                    >
                                        <span className="w-2 h-2 rounded-full bg-brand-orange mr-2 inline-block"></span>
                                        {breed}
                                    </button>
                                ))}
                            </div>
                        </div>
                    );
                }

                // --- Multiple Select ---
                if (step.type === 'multiple') {
                    return (
                        <div className="w-full">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                                {step.options.map((opt) => {
                                    const isSelected = tempMultiSelection.includes(opt.value);
                                    return (
                                        <button
                                            key={opt.value}
                                            onClick={() => toggleMultiSelect(opt.value)}
                                            className={`
                                                relative p-6 rounded-xl shadow-md transition-all text-lg font-medium text-left border-2
                                                ${isSelected
                                                    ? 'border-brand-orange bg-orange-50 text-brand-orange'
                                                    : 'border-transparent bg-white text-brand-dark hover:border-gray-200'}
                                            `}
                                        >
                                            <div className="flex justify-between items-center">
                                                {opt.label}
                                                {isSelected && <span className="text-xl font-bold">âœ“</span>}
                                            </div>
                                        </button>
                                    );
                                })}
                            </div>
                            <div className="text-center">
                                <Button
                                    onClick={() => handleNext(tempMultiSelection)}
                                    disabled={tempMultiSelection.length === 0}
                                    className="px-12 w-full md:w-1/2 mx-auto"
                                >
                                    æ¬¡ã¸é€²ã‚€
                                </Button>
                            </div>
                        </div>
                    );
                }

                // --- Single Select ---
                return (
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {step.options.map((opt) => (
                            <button
                                key={opt.value}
                                onClick={() => handleNext(opt.value)}
                                className="bg-white border-2 border-transparent hover:border-brand-orange p-6 rounded-xl shadow-md transition-all text-lg font-medium text-brand-dark hover:shadow-lg text-left"
                            >
                                {opt.label}
                            </button>
                        ))}
                    </div>
                );
            };

            return (
                <div className="max-w-2xl mx-auto py-12 px-4 fade-in min-h-[50vh] flex flex-col justify-center">
                    <h2 className="text-center text-brand-orange font-bold tracking-widest mb-2">STEP {currentStep + 1} / {STEPS.length}</h2>
                    <h3 className="text-2xl md:text-3xl font-bold text-center mb-8 text-brand-dark">
                        {step.question}
                        {step.type === 'multiple' && <span className="block text-base text-brand-accent font-normal mt-2">â€»è¤‡æ•°é¸æŠã—ã¦ã€Œæ¬¡ã¸ã€ã‚’æŠ¼ã—ã¦ãã ã•ã„</span>}
                    </h3>

                    {renderStepContent()}

                    {currentStep > 0 && (
                        <div className="mt-8 text-center">
                            <button
                                onClick={() => setCurrentStep(prev => prev - 1)}
                                className="text-gray-400 text-sm underline hover:text-gray-600"
                            >
                                å‰ã«æˆ»ã‚‹
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        const ProductCard = ({ product, rank }) => (
            <div className="bg-white rounded-2xl overflow-hidden shadow-xl mb-8 relative fade-in border border-stone-100 transform transition-all hover:scale-[1.02] duration-300">
                {/* Rank Badge */}
                <div className={`absolute top-0 left-0 text-white px-5 py-2 rounded-br-2xl font-bold text-lg z-10 shadow-md ${product.tags.priority === 'S' ? 'bg-gradient-to-r from-yellow-400 to-orange-500' :
                    product.tags.priority === 'A' ? 'bg-gradient-to-r from-gray-600 to-gray-800' :
                        'bg-gray-400'
                    }`}>
                    {rank}ä½ <span className="text-sm font-normal ml-1">(ãƒ©ãƒ³ã‚¯{product.tags.priority})</span>
                </div>

                <div className="md:flex h-full">
                    <div className="md:w-2/5 relative min-h-[250px]">
                        <img src={product.img} alt={product.name} className="w-full h-full object-cover" />
                    </div>
                    <div className="p-6 md:w-3/5 flex flex-col justify-between">
                        <div>
                            <div className="flex justify-between items-start mb-2 pl-24 md:pl-0">
                                <h3 className="text-xl md:text-2xl font-bold text-brand-dark leading-tight">{product.name}</h3>
                            </div>

                            <div className="flex flex-wrap gap-2 mb-4">
                                {product.feature && product.feature.split('ãƒ»').map((f, i) => (
                                    <span key={i} className="bg-orange-50 text-brand-orange px-2 py-1 rounded text-xs font-bold border border-orange-100">
                                        {f}
                                    </span>
                                ))}
                            </div>

                            <p className="text-gray-600 mb-5 leading-relaxed text-sm md:text-base">
                                {product.description}
                            </p>

                            <div className="bg-gray-50 p-4 rounded-lg border-l-4 border-brand-orange mb-5">
                                <p className="text-xs text-brand-orange font-bold mb-1 flex items-center">
                                    <span className="text-lg mr-1">ğŸ¶</span> é£¼ã„ä¸»æ§˜ã®å£°
                                </p>
                                <p className="text-sm italic text-gray-700 leading-relaxed">"{product.ownerVoice}"</p>
                            </div>
                        </div>

                        <div className="flex items-center justify-between mt-auto pt-4 border-t border-gray-100">
                            <div>
                                <p className="text-xs text-gray-400">å‚è€ƒä¾¡æ ¼</p>
                                <p className="text-xl md:text-2xl font-bold text-brand-accent">{product.price}</p>
                            </div>
                            <Button className="px-6 py-2 shadow-lg" onClick={() => alert('ã‚¢ãƒ•ã‚£ãƒªã‚¨ã‚¤ãƒˆãƒªãƒ³ã‚¯ã¸é·ç§»ã—ã¾ã™')}>
                                å…¬å¼ã‚µã‚¤ãƒˆã¸
                            </Button>
                        </div>
                    </div>
                </div>
            </div>
        );

        const Results = ({ answers, onReset }) => {
            const sortedProducts = useMemo(() => {
                return [...PRODUCTS].map(p => {
                    let score = 0;

                    // 1. Age Match (Critical)
                    if (p.tags.age !== 'all' && p.tags.age !== answers.age) {
                        score -= 1000;
                    } else {
                        score += 50;
                    }

                    // 2. Priority Bonus (Balanced for Reliability)
                    // Adjusted to ensure niche winners can beat 'S' rank
                    if (p.tags.priority === 'S') score += 25;
                    if (p.tags.priority === 'A') score += 15;
                    if (p.tags.priority === 'B') score += 5;

                    // 3. Concern Match (Dominant Factor)
                    if (Array.isArray(answers.concern)) {
                        // Primary Matches
                        if (answers.concern.includes(p.tags.concern)) score += 60; // Huge boost for solving main problem

                        // Secondary Matches
                        if (p.tags.secondaryConcern) {
                            p.tags.secondaryConcern.forEach(c => {
                                if (answers.concern.includes(c)) score += 30;
                            });
                        }

                        // 'None' Handling
                        if (answers.concern.includes('none') && p.tags.concern === 'none') {
                            score += 50;
                        }
                    }

                    return { ...p, score };
                })
                    .filter(p => p.score > 0)
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 3);
            }, [answers]);

            return (
                <div className="max-w-3xl mx-auto py-12 px-4 fade-in">
                    <div className="text-center mb-12">
                        <h2 className="text-3xl font-bold text-brand-dark mb-4">è¨ºæ–­çµæœ</h2>
                        <div className="inline-block bg-brand-beige px-6 py-2 rounded-full border border-brand-orange mb-4">
                            <span className="text-brand-orange font-bold mr-2">{answers.breed}</span>
                            <span className="text-gray-600">ã®</span>
                            <span className="text-brand-orange font-bold mx-2">{answers.age === 'puppy' ? 'å­çŠ¬' : answers.age === 'senior' ? 'ã‚·ãƒ‹ã‚¢çŠ¬' : 'æˆçŠ¬'}</span>
                            <span className="text-gray-600">ã«ã´ã£ãŸã‚Šãªã®ã¯...</span>
                        </div>
                        <p className="text-lg text-gray-600">
                            ã‚ãªãŸã®ã‚ã‚“ã¡ã‚ƒã‚“å°‚ç”¨ã®<br className="md:hidden" />æœ€å¼·ãƒ•ãƒ¼ãƒ‰BEST3ã‚’é¸å‡ºã—ã¾ã—ãŸï¼
                        </p>
                    </div>

                    <div className="space-y-10">
                        {sortedProducts.map((p, idx) => (
                            <ProductCard key={p.id} product={p} rank={idx + 1} />
                        ))}
                    </div>

                    <div className="mt-16 text-center bg-white p-6 md:p-8 rounded-2xl shadow-sm border border-orange-100 max-w-xl mx-auto">
                        <h3 className="text-lg font-bold text-brand-orange mb-2">
                            PePreã®é¸å®šåŸºæº–ã«ã¤ã„ã¦
                        </h3>
                        <p className="text-gray-500 text-sm leading-relaxed">
                            â€»æˆåˆ†ã€åŸææ–™ã€å£ã‚³ãƒŸã€ã‚³ã‚¹ãƒ‘ãªã©ã‚’ç·åˆçš„ã«åˆ†æã—ã€<br className="hidden md:block" />
                            ã‚ãªãŸã®æ„›çŠ¬ã«æœ€ã‚‚ãƒ¡ãƒªãƒƒãƒˆã®ã‚ã‚‹å•†å“ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚
                        </p>
                        <div className="mt-6">
                            <button onClick={onReset} className="text-gray-400 underline hover:text-brand-orange transition-colors">
                                ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [isDiagnosing, setIsDiagnosing] = useState(true);
            const [answers, setAnswers] = useState(null);

            const handleComplete = (resultAnswers) => {
                setAnswers(resultAnswers);
                setIsDiagnosing(false);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const handleReset = () => {
                setAnswers(null);
                setIsDiagnosing(true);
            };

            return (
                <div className="min-h-screen flex flex-col font-sans">
                    <Header />

                    <main className="flex-grow">
                        {isDiagnosing ? (
                            <div className="container mx-auto">
                                <div className="text-center py-12 px-4">
                                    <img src="./images/hero_v4.png" alt="PePre Hero" className="mx-auto w-32 md:w-48 mb-6 fade-in mix-blend-multiply" />
                                    <h1 className="text-2xl md:text-4xl font-bold text-brand-dark mb-6 leading-tight">
                                        <span className="inline-block">æ„›çŠ¬ã«ã´ã£ãŸã‚Šã®</span><span className="inline-block">"ä¸€çš¿"ãŒè¦‹ã¤ã‹ã‚‹</span><br />
                                        <span className="text-3xl md:text-5xl text-brand-orange mt-2 block">ãƒ•ãƒ¼ãƒ‰è¨ºæ–­</span>
                                    </h1>
                                    <p className="text-gray-600 max-w-lg mx-auto leading-relaxed">
                                        <span className="inline-block">ãŸã£ãŸ3ã¤ã®</span><span className="inline-block">è³ªå•ã«ç­”ãˆã‚‹ã ã‘ã§ã€</span><br className="hidden md:block" />
                                        <span className="inline-block">ã‚ãªãŸã®æ„›çŠ¬ã«æœ€é©ãª</span><span className="inline-block">å³é¸ãƒ•ãƒ¼ãƒ‰ã‚’ã”ææ¡ˆã—ã¾ã™ã€‚</span>
                                    </p>
                                </div>
                                <DiagnosisWizard onComplete={handleComplete} />
                            </div>
                        ) : (
                            <Results answers={answers} onReset={handleReset} />
                        )}
                    </main>

                    <Footer />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>